<!-- analytics/templates/analytics/manager_kabinet.html -->
{% extends 'main/base.html' %}

{% block title %}Кабинет менеджера{% endblock %}

{% block content %}
    <div class="container mt-4">
        <h2 class="mb-4">Кабинет менеджера</h2>
        <h3 class="mb-3">Заказы</h3>

        <form method="get" action="{% url 'manager_kabinet' %}" class="form-inline mb-4">
            <div class="form-group mx-sm-3 mb-2">
                <input type="text" name="filter_date" class="form-control" placeholder="Дата заказа (дд.мм.гггг)" value="{{ request.GET.filter_date }}">
            </div>
            <div class="form-group mx-sm-3 mb-2">
                <select name="filter_status" class="form-control">
                    <option value="">Все</option>
                    <option value="sobrano" {% if request.GET.filter_status == "sobrano" %}selected{% endif %}>Собрано</option>
                    <option value="peredano_dostavka" {% if request.GET.filter_status == "peredano_dostavka" %}selected{% endif %}>В доставку</option>
                    <option value="zakaz_dostavlen" {% if request.GET.filter_status == "zakaz_dostavlen" %}selected{% endif %}>Доставлен</option>
                    <option value="zakaz_poluchen" {% if request.GET.filter_status == "zakaz_poluchen" %}selected{% endif %}>Получен</option>
                    <option value="zakaz_zakryt" {% if request.GET.filter_status == "zakaz_zakryt" %}selected{% endif %}>Закрыт</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary mb-2">Фильтровать</button>
        </form>

        <form method="post" action="{% url 'update_order_status' %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary mb-3">Применить</button>

            {% for order in orders %}
                <div class="card mb-2 shadow-sm">
                    <div class="card-header py-2">
                        <h5 class="mb-1 d-inline" style="font-size: 1rem;">Заказ №{{ order.ID }}</h5>
                        <p class="mb-0 d-inline" style="font-size: 0.875rem;">
                            <span> | Дата: {{ order.DataZakaza|date:"d.m.Y H:i" }}</span> |
                            <span>Стоимость: {{ order.total_price }} руб.</span>
                        </p>
                    </div>
                    <div class="card-body py-2">
                        {% if order.ID_adres %}
                            <p class="mb-1" style="font-size: 0.875rem;">
                                <strong>Адрес доставки:</strong> {{ order.ID_adres.Gorod }}, {{ order.ID_adres.adres }}
                            </p>
                        {% else %}
                            <p class="mb-1" style="font-size: 0.875rem;">
                                <strong>Адрес доставки:</strong> не указан
                            </p>
                        {% endif %}
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" name="orders[{{ order.ID }}][Sobrano]" id="Sobrano{{ order.ID }}" {% if order.Sobrano %}checked{% endif %}>
                            <label class="form-check-label" for="Sobrano{{ order.ID }}">Собрано</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" name="orders[{{ order.ID }}][Peredano_dostavka]" id="Peredano_dostavka{{ order.ID }}" {% if order.Peredano_dostavka %}checked{% endif %}>
                            <label class="form-check-label" for="Peredano_dostavka{{ order.ID }}">В доставку</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" name="orders[{{ order.ID }}][Zakaz_dostavlen]" id="Zakaz_dostavlen{{ order.ID }}" {% if order.Zakaz_dostavlen %}checked{% endif %}>
                            <label class="form-check-label" for="Zakaz_dostavlen{{ order.ID }}">Доставлен</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" name="orders[{{ order.ID }}][Zakaz_Poluchen]" id="Zakaz_Poluchen{{ order.ID }}" {% if order.Zakaz_Poluchen %}checked{% endif %}>
                            <label class="form-check-label" for="Zakaz_Poluchen{{ order.ID }}">Получен</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" name="orders[{{ order.ID }}][Zakaz_zakryt]" id="Zakaz_zakryt{{ order.ID }}" {% if order.Zakaz_zakryt %}checked{% endif %}>
                            <label class="form-check-label" for="Zakaz_zakryt{{ order.ID }}">Закрыт</label>
                        </div>
                        <a href="{% url 'zakaz_podrobno' order.ID %}" class="btn btn-info btn-sm">Подробнее</a>
                    </div>
                </div>
            {% endfor %}
        </form>
    </div>
{% endblock %}
